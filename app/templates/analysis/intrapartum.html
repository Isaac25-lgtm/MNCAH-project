{% extends "base.html" %}

{% block title %}Intrapartum Care Analysis - MOH MNCAH Dashboard{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('analysis.index') }}">Analysis</a></li>
        <li class="breadcrumb-item active">Intrapartum Analysis</li>
    </ol>
</nav>
{% endblock %}

{% block page_header %}
<div class="page-header">
    <div class="row align-items-center">
        <div class="col">
            <h1 class="h2 mb-0">
                <i class="fas fa-heartbeat text-success me-2"></i>
                Intrapartum Care Analysis
            </h1>
            <p class="text-muted mb-0">Analysis of delivery outcomes and maternal and perinatal health indicators</p>
        </div>
        <div class="col-auto">
            <div class="btn-group" role="group">
                <button class="btn btn-outline-primary me-2" onclick="exportData('pdf')">
                    <i class="fas fa-file-pdf me-1"></i> Export PDF
                </button>
                <button class="btn btn-outline-success" onclick="exportData('excel')">
                    <i class="fas fa-file-excel me-1"></i> Export Excel
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- Key Metrics Cards -->
<div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card border-primary h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <div class="small fw-bold text-primary text-uppercase mb-1">
                            Institutional Deliveries
                        </div>
                        <div class="h4 mb-0 fw-bold text-gray-800">
                            {{ "%.1f"|format(indicators.get('deliveries', 0)) }}%
                        </div>
                        <small class="text-muted">Target: ≥68%</small>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-hospital fa-2x 
                           {% if indicators.get('deliveries', 0) >= 68 %}text-success
                           {% elif indicators.get('deliveries', 0) >= 55 %}text-warning
                           {% else %}text-danger{% endif %}"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card border-warning h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <div class="small fw-bold text-warning text-uppercase mb-1">
                            Low Birth Weight
                        </div>
                        <div class="h4 mb-0 fw-bold text-gray-800">
                            {{ "%.1f"|format(indicators.get('lbw_proportion', 0)) }}%
                        </div>
                        <small class="text-muted">Target: ≤5%</small>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-weight fa-2x 
                           {% if indicators.get('lbw_proportion', 0) <= 5 %}text-success
                           {% elif indicators.get('lbw_proportion', 0) <= 10 %}text-warning
                           {% else %}text-danger{% endif %}"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card border-danger h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <div class="small fw-bold text-danger text-uppercase mb-1">
                            Perinatal Mortality Rate
                        </div>
                        <div class="h4 mb-0 fw-bold text-gray-800">
                            {{ "%.1f"|format(indicators.get('perinatal_mortality_rate', 0)) }}
                        </div>
                        <small class="text-muted">per 1,000 births (Target: ≤12)</small>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-exclamation-triangle fa-2x 
                           {% if indicators.get('perinatal_mortality_rate', 0) <= 12 %}text-success
                           {% elif indicators.get('perinatal_mortality_rate', 0) <= 20 %}text-warning
                           {% else %}text-danger{% endif %}"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card border-info h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <div class="small fw-bold text-info text-uppercase mb-1">
                            Neonatal Mortality Rate
                        </div>
                        <div class="h4 mb-0 fw-bold text-gray-800">
                            {{ "%.1f"|format(indicators.get('neonatal_mortality_rate', 0)) }}
                        </div>
                        <small class="text-muted">per 1,000 live births (Target: ≤5)</small>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-child fa-2x 
                           {% if indicators.get('neonatal_mortality_rate', 0) <= 5 %}text-success
                           {% elif indicators.get('neonatal_mortality_rate', 0) <= 10 %}text-warning
                           {% else %}text-danger{% endif %}"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Critical Outcomes Analysis -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0 fw-bold">
                    <i class="fas fa-chart-line me-2"></i>
                    Birth Outcomes & Quality Indicators
                </h6>
            </div>
            <div class="card-body">
                <canvas id="birthOutcomesChart" height="300"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card shadow h-100">
            <div class="card-header bg-success text-white">
                <h6 class="mb-0 fw-bold">
                    <i class="fas fa-shield-alt me-2"></i>
                    Emergency Response
                </h6>
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <div class="h4 text-{{ 'success' if indicators.get('birth_asphyxia', 0) <= 1 else 'warning' if indicators.get('birth_asphyxia', 0) <= 3 else 'danger' }}">
                        {{ "%.1f"|format(indicators.get('birth_asphyxia', 0)) }}%
                    </div>
                    <div class="text-muted">Birth Asphyxia Rate</div>
                    <small class="text-muted">Target: ≤1%</small>
                </div>
                
                <div class="text-center mb-3">
                    <div class="h4 text-{{ 'success' if indicators.get('birth_asphyxia_resuscitated', 0) >= 100 else 'warning' if indicators.get('birth_asphyxia_resuscitated', 0) >= 80 else 'danger' }}">
                        {{ "%.1f"|format(indicators.get('birth_asphyxia_resuscitated', 0)) }}%
                    </div>
                    <div class="text-muted">Successful Resuscitation</div>
                    <small class="text-muted">Target: 100%</small>
                </div>
                
                <div class="text-center">
                    <div class="h4 text-{{ 'success' if indicators.get('lbw_kmc', 0) >= 100 else 'warning' if indicators.get('lbw_kmc', 0) >= 90 else 'danger' }}">
                        {{ "%.1f"|format(indicators.get('lbw_kmc', 0)) }}%
                    </div>
                    <div class="text-muted">LBW on KMC</div>
                    <small class="text-muted">Target: 100%</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mortality Rates Dashboard -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-danger text-white">
                <h6 class="mb-0 fw-bold">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Mortality Surveillance Dashboard
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-3 text-center border-end">
                        <div class="h3 text-{{ 'success' if indicators.get('fresh_stillbirth_rate', 0) <= 5 else 'warning' if indicators.get('fresh_stillbirth_rate', 0) <= 10 else 'danger' }}">
                            {{ "%.1f"|format(indicators.get('fresh_stillbirth_rate', 0)) }}
                        </div>
                        <div class="text-muted">Fresh Stillbirth Rate</div>
                        <small class="text-muted">per 1,000 deliveries (Target: ≤5)</small>
                    </div>
                    <div class="col-lg-3 text-center border-end">
                        <div class="h3 text-{{ 'success' if indicators.get('neonatal_mortality_rate', 0) <= 5 else 'warning' if indicators.get('neonatal_mortality_rate', 0) <= 10 else 'danger' }}">
                            {{ "%.1f"|format(indicators.get('neonatal_mortality_rate', 0)) }}
                        </div>
                        <div class="text-muted">Neonatal Mortality</div>
                        <small class="text-muted">per 1,000 live births (Target: ≤5)</small>
                    </div>
                    <div class="col-lg-3 text-center border-end">
                        <div class="h3 text-{{ 'success' if indicators.get('perinatal_mortality_rate', 0) <= 12 else 'warning' if indicators.get('perinatal_mortality_rate', 0) <= 20 else 'danger' }}">
                            {{ "%.1f"|format(indicators.get('perinatal_mortality_rate', 0)) }}
                        </div>
                        <div class="text-muted">Perinatal Mortality</div>
                        <small class="text-muted">per 1,000 births (Target: ≤12)</small>
                    </div>
                    <div class="col-lg-3 text-center">
                        <div class="h3 text-danger">
                            {{ "%.0f"|format(indicators.get('institutional_mmr', 0)) }}
                        </div>
                        <div class="text-muted">Institutional MMR</div>
                        <small class="text-muted">per 100,000 live births</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Indicators Table -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="mb-0 fw-bold text-primary">Intrapartum Indicators Summary</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="intrapartumTable">
                        <thead class="table-light">
                            <tr>
                                <th>Indicator</th>
                                <th>Value</th>
                                <th>Target</th>
                                <th>Status</th>
                                <th>Clinical Significance</th>
                                <th>Recommended Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% set intrapartum_indicators = [
                                ('deliveries', 'Institutional Deliveries', 'Facility-based deliveries', 68, '≥68%', '%'),
                                ('lbw_proportion', 'Low Birth Weight (LBW)', 'Babies <2.5kg at birth', 5, '≤5%', '%'),
                                ('lbw_kmc', 'LBW Babies on KMC', 'Kangaroo Mother Care initiation', 100, '100%', '%'),
                                ('birth_asphyxia', 'Birth Asphyxia Rate', 'Inadequate oxygen at birth', 1, '≤1%', '%'),
                                ('birth_asphyxia_resuscitated', 'Successful Resuscitation', 'Of babies with birth asphyxia', 100, '100%', '%'),
                                ('fresh_stillbirth_rate', 'Fresh Stillbirth Rate', 'Intrapartum deaths per 1,000 deliveries', 5, '≤5 per 1,000', '‰'),
                                ('neonatal_mortality_rate', 'Neonatal Mortality Rate', 'Deaths in first 28 days per 1,000 live births', 5, '≤5 per 1,000', '‰'),
                                ('perinatal_mortality_rate', 'Perinatal Mortality Rate', 'Stillbirths + early neonatal deaths per 1,000 births', 12, '≤12 per 1,000', '‰'),
                                ('institutional_mmr', 'Institutional MMR', 'Maternal deaths per 100,000 live births', 336, 'Target: <336', 'MMR')
                            ] %}
                            
                            {% for indicator_key, indicator_name, description, target, target_display, unit in intrapartum_indicators %}
                            {% set value = indicators.get(indicator_key, 0) %}
                            {% set validation_status = validations.get(indicator_key, 'unknown') %}
                            <tr class="{% if validation_status == 'green' %}table-success{% elif validation_status == 'yellow' %}table-warning{% elif validation_status == 'red' %}table-danger{% else %}table-light{% endif %}">
                                <td>
                                    <strong>{{ indicator_name }}</strong>
                                    <br><small class="text-muted">{{ description }}</small>
                                </td>
                                <td>
                                    {% if unit == '%' %}
                                        {{ "%.1f"|format(value) }}%
                                    {% elif unit == '‰' %}
                                        {{ "%.1f"|format(value) }}
                                    {% elif unit == 'MMR' %}
                                        {{ "%.0f"|format(value) }}
                                    {% endif %}
                                </td>
                                <td>{{ target_display }}</td>
                                <td>
                                    {% if validation_status == 'green' %}
                                        <span class="badge bg-success">Good</span>
                                    {% elif validation_status == 'yellow' %}
                                        <span class="badge bg-warning">Needs Attention</span>
                                    {% elif validation_status == 'red' %}
                                        <span class="badge bg-danger">Critical</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Unknown</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if indicator_key == 'deliveries' %}
                                        Access to skilled birth attendance and emergency obstetric care
                                    {% elif indicator_key == 'lbw_proportion' %}
                                        Indicator of maternal nutrition and prenatal care quality
                                    {% elif indicator_key == 'lbw_kmc' %}
                                        Critical for LBW baby survival and development
                                    {% elif indicator_key == 'birth_asphyxia' %}
                                        Quality of intrapartum care and emergency response
                                    {% elif indicator_key == 'birth_asphyxia_resuscitated' %}
                                        Effectiveness of newborn resuscitation protocols
                                    {% elif indicator_key == 'fresh_stillbirth_rate' %}
                                        Quality of intrapartum monitoring and intervention
                                    {% elif indicator_key == 'neonatal_mortality_rate' %}
                                        Overall quality of newborn care and early detection
                                    {% elif indicator_key == 'perinatal_mortality_rate' %}
                                        Combined indicator of maternal and newborn care quality
                                    {% elif indicator_key == 'institutional_mmr' %}
                                        Quality of emergency obstetric care and maternal health services
                                    {% endif %}
                                </td>
                                <td>
                                    {% if validation_status == 'red' %}
                                        <span class="text-danger">Immediate intervention needed</span>
                                    {% elif validation_status == 'yellow' %}
                                        <span class="text-warning">Improvement required</span>
                                    {% elif validation_status == 'green' %}
                                        <span class="text-success">Maintain performance</span>
                                    {% else %}
                                        <span class="text-muted">Review data quality</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Data Quality Issues -->
{% if validation_errors %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-danger shadow">
            <div class="card-header bg-danger text-white">
                <h6 class="mb-0 fw-bold">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Data Quality Issues
                </h6>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <h6>The following validation errors were detected:</h6>
                    <ul class="mb-0">
                        {% for error in validation_errors %}
                        <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                    <small class="text-muted">
                        <strong>Note:</strong> These values are still displayed but marked for review.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Recommendations -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0 fw-bold">
                    <i class="fas fa-lightbulb me-2"></i>
                    Clinical Recommendations
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-danger">Priority Areas:</h6>
                        <ul class="list-unstyled">
                            {% if indicators.get('perinatal_mortality_rate', 0) > 20 %}
                            <li class="mb-2">
                                <i class="fas fa-exclamation-circle text-danger me-2"></i>
                                <strong>Perinatal Mortality:</strong> Comprehensive review of delivery protocols needed
                            </li>
                            {% endif %}
                            {% if indicators.get('birth_asphyxia', 0) > 3 %}
                            <li class="mb-2">
                                <i class="fas fa-exclamation-circle text-danger me-2"></i>
                                <strong>Birth Asphyxia:</strong> Strengthen intrapartum monitoring and intervention
                            </li>
                            {% endif %}
                            {% if indicators.get('lbw_proportion', 0) > 10 %}
                            <li class="mb-2">
                                <i class="fas fa-exclamation-circle text-danger me-2"></i>
                                <strong>Low Birth Weight:</strong> Improve antenatal nutrition counseling
                            </li>
                            {% endif %}
                            {% if indicators.get('deliveries', 0) < 55 %}
                            <li class="mb-2">
                                <i class="fas fa-exclamation-circle text-danger me-2"></i>
                                <strong>Institutional Deliveries:</strong> Strengthen referral systems and transport
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-success">Strengths to Maintain:</h6>
                        <ul class="list-unstyled">
                            {% if indicators.get('birth_asphyxia_resuscitated', 0) >= 100 %}
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <strong>Resuscitation:</strong> Excellent emergency response protocols
                            </li>
                            {% endif %}
                            {% if indicators.get('lbw_kmc', 0) >= 100 %}
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <strong>KMC:</strong> Universal kangaroo mother care implementation
                            </li>
                            {% endif %}
                            {% if indicators.get('perinatal_mortality_rate', 0) <= 12 %}
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <strong>Perinatal Care:</strong> Excellent perinatal outcomes achieved
                            </li>
                            {% endif %}
                            <li class="mb-2">
                                <i class="fas fa-info-circle text-info me-2"></i>
                                <strong>General:</strong> Continue quality improvement initiatives
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between">
            <a href="{{ url_for('dashboard.index') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
            </a>
            <div>
                <button class="btn btn-outline-primary" onclick="viewTrends()">
                    <i class="fas fa-chart-line me-1"></i> View Historical Trends
                </button>
                <button class="btn btn-primary" onclick="generateReport()">
                    <i class="fas fa-file-alt me-1"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="application/json" id="intrapartum-data">
{
    "indicators": {
        "deliveries": {{ indicators.get('deliveries', 0) }},
        "lbw_proportion": {{ indicators.get('lbw_proportion', 0) }},
        "lbw_kmc": {{ indicators.get('lbw_kmc', 0) }},
        "birth_asphyxia": {{ indicators.get('birth_asphyxia', 0) }},
        "birth_asphyxia_resuscitated": {{ indicators.get('birth_asphyxia_resuscitated', 0) }},
        "fresh_stillbirth_rate": {{ indicators.get('fresh_stillbirth_rate', 0) }},
        "neonatal_mortality_rate": {{ indicators.get('neonatal_mortality_rate', 0) }},
        "perinatal_mortality_rate": {{ indicators.get('perinatal_mortality_rate', 0) }}
    },
    "urls": {
        "export_pdf": "{{ url_for('reports.export_intrapartum_pdf') }}",
        "export_excel": "{{ url_for('reports.export_intrapartum_excel') }}",
        "trends": "{{ url_for('analysis.trends') }}?category=intrapartum",
        "report": "{{ url_for('reports.intrapartum_report') }}"
    }
}
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Birth Outcomes Chart
    initializeBirthOutcomesChart();
    
    // Initialize DataTable for indicators
    $('#intrapartumTable').DataTable({
        "pageLength": 10,
        "order": [],
        "columnDefs": [
            {"orderable": false, "targets": [5]}
        ],
        "language": {
            "search": "Search indicators:",
            "lengthMenu": "Show _MENU_ indicators"
        }
    });
});

function initializeBirthOutcomesChart() {
    const ctx = document.getElementById('birthOutcomesChart');
    if (!ctx) return;
    
    // Get data from JSON script tag
    const dataElement = document.getElementById('intrapartum-data');
    const data = JSON.parse(dataElement.textContent);
    
    const chartData = {
        labels: ['Deliveries (%)', 'LBW (%)', 'KMC (%)', 'Asphyxia (%)', 'Resuscitated (%)', 'Fresh SB (‰)', 'NMR (‰)', 'PMR (‰)'],
        values: [
            data.indicators.deliveries,
            data.indicators.lbw_proportion,
            data.indicators.lbw_kmc,
            data.indicators.birth_asphyxia,
            data.indicators.birth_asphyxia_resuscitated,
            data.indicators.fresh_stillbirth_rate,
            data.indicators.neonatal_mortality_rate,
            data.indicators.perinatal_mortality_rate
        ]
    };
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: chartData.labels,
            datasets: [{
                label: 'Current Values',
                data: chartData.values,
                backgroundColor: chartData.values.map((value, index) => {
                    // Specific coloring for each indicator based on targets
                    switch(index) {
                        case 0: // Deliveries
                            return value >= 68 ? '#28a745' : value >= 55 ? '#ffc107' : '#dc3545';
                        case 1: // LBW (lower is better)
                            return value <= 5 ? '#28a745' : value <= 10 ? '#ffc107' : '#dc3545';
                        case 2: case 4: // KMC, Resuscitated
                            return value >= 100 ? '#28a745' : value >= 90 ? '#ffc107' : '#dc3545';
                        case 3: // Birth Asphyxia (lower is better)
                            return value <= 1 ? '#28a745' : value <= 3 ? '#ffc107' : '#dc3545';
                        case 5: case 6: // Fresh SB, NMR (lower is better)
                            return value <= 5 ? '#28a745' : value <= 10 ? '#ffc107' : '#dc3545';
                        case 7: // PMR (lower is better)
                            return value <= 12 ? '#28a745' : value <= 20 ? '#ffc107' : '#dc3545';
                        default:
                            return '#6c757d';
                    }
                }),
                borderColor: '#ffffff',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value.toFixed(1);
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label;
                            const value = context.parsed.y;
                            if (label.includes('‰')) {
                                return label + ': ' + value.toFixed(1) + ' per 1,000';
                            } else {
                                return label + ': ' + value.toFixed(1) + '%';
                            }
                        }
                    }
                }
            }
        }
    });
}

// Export functions
function exportData(format) {
    MOH.showLoading('Preparing export...');
    
    // Get data from JSON script tag
    const dataElement = document.getElementById('intrapartum-data');
    const data = JSON.parse(dataElement.textContent);
    
    const url = format === 'pdf' ? data.urls.export_pdf : data.urls.export_excel;
    
    fetch(url)
        .then(response => {
            if (response.ok) {
                return response.blob();
            }
            throw new Error('Export failed');
        })
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Intrapartum_Analysis_${new Date().toISOString().split('T')[0]}.${format}`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            MOH.showMessage(`Intrapartum analysis exported successfully`, 'success');
        })
        .catch(error => {
            console.error('Export error:', error);
            MOH.showMessage('Export failed. Please try again.', 'error');
        })
        .finally(() => {
            MOH.hideLoading();
        });
}

function viewTrends() {
    // Get data from JSON script tag
    const dataElement = document.getElementById('intrapartum-data');
    const data = JSON.parse(dataElement.textContent);
    
    window.location.href = data.urls.trends;
}

function generateReport() {
    // Get data from JSON script tag
    const dataElement = document.getElementById('intrapartum-data');
    const data = JSON.parse(dataElement.textContent);
    
    window.location.href = data.urls.report;
}
</script>
{% endblock %}